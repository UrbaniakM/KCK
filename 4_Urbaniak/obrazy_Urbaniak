from matplotlib import pyplot as plt
from skimage import data, io, measure, color, feature, filters, exposure, img_as_ubyte
import numpy as np

def detect_edges(image, n):
    subPlt = plt.subplot(7,3,n+1)
    subPlt.axis('off')
    percentileP, percentileK = np.percentile(image,(2,98))
    imageGray = exposure.rescale_intensity(image,in_range=(percentileP,percentileK))
    #io.imshow(imageGray)
    imageGray = color.rgb2grey(imageGray)
    edges = measure.find_contours(imageGray, level=0.3, fully_connected='low', positive_orientation='high')
    for n, edge in enumerate(edges):
        coords = measure.approximate_polygon(edge, tolerance=5.5)
        subPlt.plot(coords[:, 1], coords[:, 0], linewidth=1)
    subPlt.plot(0,0)
    io.imshow(image)

def get_histogram(image,n):
    dane = img_as_ubyte(image)
    histo, x = np.histogram(dane, range(0,256), density=True);
    subPlt = plt.subplot(7,3,n+1)
    subPlt.plot(histo, linewidth=1)

if __name__ == '__main__':

    plt.figure(figsize=(15,15),facecolor='black')
    images = io.ImageCollection('images/*.jpg')

    #EROZJA I DYLATACJA (operacje morfologiczne - usuniecie punkcikow, 'falszywych krawedzi')
    for n,image in enumerate(images):
        get_histogram(image,n)

    plt.tight_layout()
    plt.savefig('histo_Urbaniak.pdf')
    plt.close()

    plt.figure(figsize=(15,15),facecolor='black')
    for n,image in enumerate(images):
        detect_edges(image,n)
    plt.savefig('obrazy_Urbaniak.pdf')   
